<h1><?php echo $this->title ?></h1>

<?php
$form = $this->form;
$form->prepare ();
$form->setAttribute ( 'action', $this->url ( 'empresas', array (
		'controller' => 'index',
		'action' => 'guardar' 
) ) );

$form->setAttribute ( 'method', 'post' );

$formLabel = $this->plugin ( 'formLabel' );

$comment=$this->comment;

echo $this->form ()->openTag ( $form );
?>
<?php echo $this->formRow($form->get('EMP_ID')); ?>

<?php echo $this->formRow($form->get('ESTADO_OCULTO')); ?>
<?php echo $this->formRow($form->get('CIUDAD_OCULTO')); ?>

<?php echo $this->formRow($form->get('EMP_NOMBRE')); ?>
<?php echo $this->formRow($form->get('CAT_EMP_ID')); ?>

<?php echo $this->formRow($form->get('PAI_ID')); ?>
<?php echo $this->formRow($form->get('EST_ID')); ?>
<?php echo $this->formRow($form->get('CIU_ID')); ?>

<?php echo $this->formRow($form->get('EMP_DIRECCION')); ?>
<?php echo $this->formRow($form->get('EMP_REFERENCIA')); ?>
<?php echo $this->formRow($form->get('EMP_SECTOR')); ?>
<?php echo $this->formRow($form->get('EMP_EMAIL')); ?>
<?php echo $this->formRow($form->get('EMP_PAGINA_WEB')); ?>
<hr>
<?php $indice_detalle_contacto=0; ?>
<table id='detalle_contacto'>
	<tr>
		<td><?php echo $this->formRow($form->get('DETALLE_CONTACTO['.$indice_detalle_contacto.'][TIP_TEL_ID]')); ?></td>
		<td><?php echo $this->formRow($form->get('DETALLE_CONTACTO['.$indice_detalle_contacto.'][DET_CON_CODIGO_PAIS]')); ?></td>
		<td><?php echo $this->formRow($form->get('DETALLE_CONTACTO['.$indice_detalle_contacto.'][DET_CON_CODIGO_CIUDAD]')); ?></td>
		<td><?php echo $this->formRow($form->get('DETALLE_CONTACTO['.$indice_detalle_contacto.'][DET_CON_VALOR]')); ?></td>
		<td><?php echo $this->formRow($form->get('DETALLE_CONTACTO['.$indice_detalle_contacto.'][DET_CON_EXTENSION]')); ?></td>
	</tr>
</table>

<?php echo $this->formRow($form->get('ADD')); ?>

<?php echo $this->formRow($form->get('SUBMIT')); ?>

<?php echo $this->form()->closeTag(); ?>

<script>

	$(document).ready(function(){
		//Carga del combo box de Códigos de teléfono de Ciudades
		$(".det_con_codigo_ciudad").prop("disabled", true);
		function codigoCiudadSelect(data_group_id){
			$(".det_con_codigo_pais[data-group-id="+data_group_id+"]").on('change',function() {
				if($(this).val() != '' && $(this).val() != null){
		            $.ajax({
		                url: "<?php echo $this->url('empresas', array('controller' => 'empresas', 'action' => 'codigoCiudad')) ?>",
		                type: "POST",
		                dataType: "json",
		                data: "det_con_codigo_pais=" + $(this).val(),
		                beforeSend: function() {
		                	$(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").html("");
		                	$(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").append('<option>Procesando, espere por favor...</option>');
		                }
		            }).done(function(ciudades) {
		                $(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").html("");
		                $(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").append('<option>-- Seleccione --</option>');
		                for (ciudad in ciudades) {
		                    $(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").append('<option value="' + ciudad + '">' + ciudades[ciudad] + '</option>');
		                }
		                $(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").prop("disabled", false);
		            });
				}else{
					$(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").prop("disabled", true);
					$(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").html("");
					$(".det_con_codigo_ciudad[data-group-id="+data_group_id+"]").append('<option>-- Seleccione --</option>');
				}
	        });
		}

		codigoCiudadSelect(0);
		//Agregar Nuevo Registro de Detalle Contacto
		var indice_detalle_contacto=1;
		$("#add").on('click',function(e){
			$("table#detalle_contacto tr:last").clone().appendTo('table#detalle_contacto');

			$("table#detalle_contacto tr:last input").each(function(i){
				$(this).attr('name',$(this).attr('name').replace(''+(indice_detalle_contacto-1),''+indice_detalle_contacto));
				$(this).attr('data-group-id',indice_detalle_contacto);
			});
			$("table#detalle_contacto tr:last select").each(function(i){
				$(this).attr('name',$(this).attr('name').replace(''+(indice_detalle_contacto-1),''+indice_detalle_contacto));
				$(this).attr('data-group-id',indice_detalle_contacto);
			});
			
			codigoCiudadSelect(indice_detalle_contacto); 
			
			indice_detalle_contacto++;
		});
		
	});
</script>
